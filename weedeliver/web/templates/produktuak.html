{% load static %}

<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href='{% static "css/general.css" %}'>
    <link rel="stylesheet" href='{% static "css/produktuak.css" %}'>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">


    <title>WeeDeliver</title>

    
</head>

<body>
    <div class="wrapper">
        <!--Navbar-->
        <div>
            <nav>
                <ul>
                    <div class="">
                        <img src='{% static "irudiak/logob.svg" %}' class="logo">
                        <li><a href="/">Hasiera</a></li>
                        <li><a href="/produktuak">Produktuak</a></li>
                        <li><a href="/kontaktua">Kontaktua</a></li>
                    </div>
  
                    {% if user.is_authenticated %}
                    <div>
                        <li><a href="/karrito" id="unitateak">(0)</a></li>
                        <li><a href="/profila">{{ user.username }}</a></li>       
                    </div>
                    {% else %}
                    <div>
                        <li><a href="/login">(0)</a></li>
                        <li><a href="/signup">Sortu Kontua</a></li>
                        <li><button><a href="/login">Hasi Saioa</a></button></li>
                    </div>
                    {% endif %}
                </ul>
            </nav>
        </div>

        <!--Carousel-->
        <div>
            <!--kategoriak-->
            <div class="kategoriak">
                <h4>Kategoriak</h4>
                {% for kategoria in kategoriak %}
                <button type="button">{{kategoria.izena}}</button>
                {% endfor %}
            </div>

            <!--Produktuak-->
            <form class="produktuak" method="POST">

                {% csrf_token %}   
                {% for produktua in produktuak %}
                <div class="product-indib">
                    <div>
                        <img src="../{{ produktua.img|cut:'web/' }}">
                        
                    </div>
                    <div class="product-info">
                        <div>
                            <h5>{{produktua.izena}}</h5>
                            <p>{{produktua.prezioa}} + bidalketa</p>
                        </div>
                        <div>
                            <button type="button" id="{{produktua.id}}" class="gehitu">+Gehitu</button>
                        </div>
                    </div>
                </div>
                {% endfor %}

            </form>
        </div>

        <!--Footer-->
   
            <footer>
                <div>
                    <img src='{% static "irudiak/logow.svg" %}' class="footer-logo">
                </div>

                <div class="footer-content">
                    <div>
                        <h3>WeeDeliver</h3>
                        <a><p>WeeDeliver-i buruz</p></a>
                        <a><p>WeeDeliver fundazioa</p></a>
                    </div>
    
                    <div>
                        <h3>Produktuak</h3>
                        <a><p>Produktuei buruz</p></a>
                        <a><p>Produktu guztiak</p></a>
                    </div>
    
                    <div>
                        <h3>Sare Sozialak</h3>
                        <img src='{% static "irudiak/instagram-icon.svg" %}'>
                        <img src='{% static "irudiak/facebook-icon.svg" %}'>
                        <img src='{% static "irudiak/x-icon.svg" %}'>
                    </div>
                </div>
            </footer>
       
    </div>
</body>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script>
$(document).ready(function () {
    $("#incorrect").hide()

    //Karritoko unitateak
    $.ajax({
        url: "{% url 'karritoko_unitateak' %}", 
        type: 'GET',
        success: function (data) {
            $('#unitateak').text('(' + data.cart_count + ')');
        },
        error: function (xhr, status, error) {
            console.log("Error: " + error);
        }
    });

    //Karritora gehitu
    $(".gehitu").on('click',function(e) {
        e.preventDefault()
        datuak = {product_id: $(this).attr("id")}
        let csrf_token = '{{csrf_token}}'
        $.ajax({
            type:'POST',
            headers: { 'X-CSRFToken': csrf_token },
            url: "{% url 'karritora_gehitu' %}",
            data: datuak,  // Pass datuak directly as the data
            success: function(response){
                window.location.reload();
            },error: function (response) {
                
            }
        })
    })
})
</script>

</html>